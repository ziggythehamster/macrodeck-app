<h1>MacroDeck Platform Test App</h1>
<%= MacroDeck::TitleBehavior.new(@item).to_html %>

<%
	num_fields_printed = 0
	if @object.fields_by_priority
		@object.fields_by_priority.each do |priority_set|
			if num_fields_printed <= 5
				priority_set[1].each do |f|
					behavior = "#{f.to_s}_behavior".camelize
					behavior = "MacroDeck::#{behavior}"
%>
					<% begin %>
						<%= behavior.constantize.new(@item).to_html %>
					<% rescue NameError %>
						<% unless @object.introspections[f.to_sym][:internal] %>
							<% if !@item.send(f.to_sym).nil? && !@item.send(f.to_sym) == "" %>
								<dl>
									<dt><%= @object.human_attribute_name(f.to_s) %></dt>
									<dd><%= @item.send(f.to_sym) %></dd>
								</dl>
							<% end %>
						<% end %>
					<% end %>
					<% num_fields_printed = num_fields_printed + 1 %>
<%
				end
			end
		end
	end
%>

<h2>Children</h2>

<%
	level = @item.path.dup.length + 1
%>

<table>
<% ::DataObject.view("by_path", :reduce => true, :group => true, :level => level)["rows"].each do |r| %>
	<% if r["key"].length == level %>
		<tr>
			<td>
				<%= DataObject.get(r["key"][-1]).title %>
			</td>
		</tr>
	<% end %>
<% end %>
</table>

